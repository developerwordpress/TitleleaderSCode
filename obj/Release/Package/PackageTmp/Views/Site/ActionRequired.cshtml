@model List<TitleLeader.Models.Dataupload.DatauploadSave>
@{
    ViewBag.Title = "ActionRequired";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
    Int32 fillteroption = ViewBag.FillterOption != null ? Convert.ToInt32(ViewBag.FillterOption) : 0;
}
<style>
    .table-responsive tr td:first-child:before {
        width: 7px;
        height: 100vh;
        background: #f67538 !important;
        position: absolute;
        content: "";
        overflow: hidden;
        clear: both;
        left: 0;
        top: 0;
    }

    .ttt {
        padding: 10px;
        line-height: 1.42857143;
        vertical-align: top;
        border-top: 1px solid #fff;
        background: #fff !important;
    }
</style>
<div class="padding-box">
    <div class="open-cart-text-box open-cart-text-box-reserch">
        <h3 class="haeding-text-gry"> Action required</h3>
        <p>Here you can view all searches that could NOT be completed due to either incomplete or inaccurate information provided on the order, or because the abstractor requires clarification from you before being able to resume the search.Depending upon when the abstractor was able to identify the existence of incomplete or inaccurate information, the search charge may be full, partial or none at all.</p>

        @using (Html.BeginForm("ActionRequired", "Site", FormMethod.Post, new { @id = "form-search" }))
        {
            <div class="row">
                <div class="col-sm-6 text-srch">
                    <div class="input-group">
                        <span class="input-group-addon" id="btn-search" style="cursor:pointer;"><i class="glyphicon glyphicon-search"></i></span>
                        <input id="txtkey" type="text" class="form-control" value="@ViewBag.search" name="txtkey" placeholder="Search notifications">

                    </div>

                </div>
                <div class="col-md-3">

                </div>
                <div class="col-sm-3 text-right">
                    <select class="form-control" id="ddlFillter" name="fillter">
                        @switch (fillteroption)
                        {
                            case 0:
                                <option value="0" selected="selected">Date</option>
                                <option value="1">Order Number</option>
                                <option value="2">Betch Number</option>
                                <option value="3">Customer Name</option>
                                <option value="4">Address</option>
                                break;
                            case 1:
                                <option value="0">Date</option>
                                <option value="1" selected="selected">Order Number</option>
                                <option value="2">Betch Number</option>
                                <option value="3">Customer Name</option>
                                <option value="4">Address</option>
                                break;
                            case 2:
                                <option value="0">Date</option>
                                <option value="1">Order Number</option>
                                <option value="2" selected="selected">Betch Number</option>
                                <option value="3">Customer Name</option>
                                <option value="4">Address</option>
                                break;
                            case 3:
                                <option value="0" selected="selected">Date</option>
                                <option value="1">Order Number</option>
                                <option value="2">Betch Number</option>
                                <option value="3" selected="selected">Customer Name</option>
                                <option value="4">Address</option>
                                break;
                            case 4:
                                <option value="0" selected="selected">Date</option>
                                <option value="1">Order Number</option>
                                <option value="2">Betch Number</option>
                                <option value="3">Customer Name</option>
                                <option value="4" selected="selected">Address</option>
                                break;
                        }
                    </select>
                </div>
            </div>
        }
        <div class="row">
            <div class="col-sm-12 tble-btn">
                @*<a href="#" class="aside-btn">Email All Selected</a>*@
                <input type="button" id="btnSaveForLater" class="aside-btn btn btn-primary" value="Email All Selected" />
            </div>
        </div>
        <div class="table-responsive">
            <table class="table" id="table-order-con">
                <thead>
                    <tr>
                        <th>
                            <div class="checkbox">
                                <label><input type="checkbox" id="chk-select-header"></label>
                            </div>
                        </th>
                        <th>Search #</th>
                        <th>Address</th>
                        <th>Unit</th>
                        <th>City</th>
                        <th>state</th>
                        <th>Zip</th>
                        <th>Country</th>
                        <th> &nbsp;</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var obj in Model)
                    {
                        <tr>
                            <td class="ttt">
                                <div class="checkbox">
                                    <label><input type="checkbox" class="chk-select"></label>
                                </div>
                            </td>
                            <td class="ttt">@obj.order_no</td>
                            <td class="ttt">@obj.street_add</td>
                            <td class="ttt">@obj.house_unit</td>
                            <td class="ttt">@obj.city</td>
                            <td class="ttt">@obj.state</td>
                            <td class="ttt">@obj.zip_code</td>
                            <td class="ttt">-</td>
                            <td class="ttt"><a type="button" style="cursor:pointer" data-container="body" data-toggle="popover" data-html="true" data-placement="top" data-content='<ul class="nav"><li><a href="#" orderid="@obj.order_no" itemid="@obj.item_no" class="btnedit"><i class="fa fa-pencil"></i> Edit</li><li><a  href="#" orderid="@obj.order_no" itemid="@obj.item_no" class="btnaskquestion"><i class="fa fa-question"></i> Ask Question Report</li></ul>'><img class="img-icon" src="~/Content/images/dots.png"></a></td>
                        </tr>
                        <tr class="without-bg">
                            <td colspan="9" style="background-color:#e4e7f2 !important;"></td>

                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="pagination">
            <a href="#">&laquo;</a>
            <a href="#"><i class="fa fa-angle-left" aria-hidden="true"></i></a>
            <a href="#">1</a>
            <a href="#">2</a>
            <a href="#">3</a>
            <a href="#">4</a>
            <a href="#"><i class="fa fa-angle-right" aria-hidden="true"></i></a>
            <a href="#">&raquo;</a>
        </div>

    </div>
</div>
<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog" id="content_block">

    </div>
</div>
@section footer
{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#btn-search").click(function () {
                $("#form-search").submit();
            });
            $('[data-toggle="popover"]').popover();
            var Begin = function (response) {
            }
            BeginFun = Begin;

            var Success = function (response) {
                if (response == "success") {
                    $("#myModal").modal("hide");
                    swal({
                        title: "Success!",
                        text: "Thank you for asking an quesion!",
                        type: "success",
                        showCancelButton: false,
                        confirmButtonColor: "#337ab7",
                        confirmButtonText: "OK",
                        closeOnConfirm: false,
                        closeOnCancel: false
                    });
                } else if (response != "error") {
                    $("#myModal").modal("hide");
                    swal({
                        title: "Success!",
                        text: "Your Details has been updated",
                        type: "success",
                        showCancelButton: false,
                        confirmButtonColor: "#337ab7",
                        confirmButtonText: "OK",
                        closeOnConfirm: false,
                        closeOnCancel: false
                    }, function (isConfirm) {
                        var url = '@Url.Action("ActionRequired", "Site")';
                        window.location.href = url;
                    });
                }
            }
            SuccessFun = Success;

            var Failure = function (response) {
            }
            FailureFun = Failure;

            var Complete = function (response) {
            }
            CompleteFun = Complete;

            $(document).on("click", ".btnaskquestion", function () {
                $('[data-original-title]').popover('hide');
                var order_no = $(this).attr("orderid");
                var item_no = $(this).attr("itemid");
                AskQuestion(order_no, item_no);
                $("#myModal").modal({
                    show: true,
                    backdrop: 'static',
                    keyboard: false
                });
            });

            var AskQuestion = function (order_no, item_no) {
                $.ajax({
                    type: "GET",
                    async: false,
                    url: '@Url.Action("AskQuestion", "Site")',
                    data: { orderno: '' + order_no + '', itemno: '' + item_no + '' },
                    contentType: "application/html; charset=utf-8",
                    dataType: "html",
                    success: function (response) {
                        $("#content_block").html(response);
                        $.validator.unobtrusive.parse($("#content_block"));
                    },
                    failure: function (response) {
                        alert("Error in Personal");
                    },
                    error: function (response) {
                        alert("Error in Personal");
                    },
                    complete: function (response) {

                    }
                });
            }

            $("#chk-select-header").change(function () {
                var headcheck = $(this).is(":checked");
                $('#table-order-con>tbody>tr').each(function (i, n) {
                    $(this).find('td:eq(0)').find(".chk-select").prop('checked', headcheck);
                });

            });

            $("#btnSaveForLater").click(function () {
                swal({
                    title: "Are you sure?",
                    text: "To mail to selected order(s).",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonClass: "btn-primary disabled",
                    confirmButtonText: "Yes, Mail selected Order(s)!",
                    showLoaderOnConfirm: false,
                    closeOnConfirm: false
                }, function () {
                    var intArray = new Array();
                    var count = 0;
                    $('#table-order-con>tbody>tr').each(function (i, n) {
                        var checktrue = $(this).find('td:eq(0)').find(".chk-select").is(":checked");
                        if (checktrue) {
                            intArray[count] = $(this).find('td:eq(9)').text();
                            count++;
                        }
                    });
                    if (intArray.length > 0) {
                    @*$("#btnSaveForLater").attr("disabled", "disabled");
                    $("#btnSaveForLater").val("Please wait..");
                    $.ajax({
                        type: "POST",
                        async: true,
                        url: '@Url.Action("ActionRequired", "Site")',
                        data: '{ "OrderItemNos":' + JSON.stringify(intArray) + '}',
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (response) {
                            if (response != "error") {
                                swal({
                                    title: "Success!",
                                    text: "Order has been saved as draft.",
                                    type: "success",
                                    showCancelButton: false,
                                    confirmButtonColor: "#337ab7",
                                    confirmButtonText: "OK",
                                    closeOnConfirm: false,
                                    closeOnCancel: false
                                }, function (isConfirm) {
                                    if (parseInt(response["count"]) > 0) {
                                        var url = '@Url.Action("Orderconfirm", "Site")?' + 'ordno=' + response["orderno"];
                                        window.location.href = url;
                                    }
                                    else {
                                        var url = '@Url.Action("SaveForLater", "Site")';
                                        window.location.href = url;
                                    }
                                });

                            }
                        },
                        failure: function (response) {
                            swal({
                                title: "Error!",
                                text: "Your session has been expiry please login.",
                                type: "error",
                                showCancelButton: false,
                                confirmButtonColor: "#337ab7",
                                confirmButtonText: "OK",
                                closeOnConfirm: false,
                                closeOnCancel: false
                            }, function (isConfirm) {
                                var url = '@Url.Action("Login", "Home")';
                                window.location.href = url;
                            });
                        },
                        error: function (response) {
                            swal({
                                title: "Error!",
                                text: "Your session has been expiry please login.",
                                type: "error",
                                showCancelButton: false,
                                confirmButtonColor: "#337ab7",
                                confirmButtonText: "OK",
                                closeOnConfirm: false,
                                closeOnCancel: false
                            }, function (isConfirm) {
                                var url = '@Url.Action("Login", "Home")';
                                window.location.href = url;
                            });
                        },
                        complete: function () {
                            $("#btnSaveForLater").removeAttr("disabled");
                            $("#btnSaveForLater").val("Save order for later");
                        }
                    });*@
                    }
                });
            });

            $(document).on("click", ".btnedit", function () {
                var order_no = $(this).attr("orderid");
                var item_no = $(this).attr("itemid");
                SaveForLetterFun(order_no, item_no);
                $("#myModal").modal({
                    show: true,
                    backdrop: 'static',
                    keyboard: false
                });
            });

            var SaveForLetterFun = function (order_no, item_no) {
                $.ajax({
                    type: "GET",
                    async: false,
                    url: '@Url.Action("EditSaveForLatter", "Site")',
                    data: { orderno: '' + order_no + '', itemno: '' + item_no + '' },
                    contentType: "application/html; charset=utf-8",
                    dataType: "html",
                    success: function (response) {
                        $("#content_block").html(response);
                        $.validator.unobtrusive.parse($("#content_block"));
                    },
                    failure: function (response) {
                        alert("Error in Personal");
                    },
                    error: function (response) {
                        alert("Error in Personal");
                    },
                    complete: function (response) {

                    }
                });
            }
        });
        function OnBegin(response) {
            BeginFun(response);
        }
        function OnSuccess(response) {
            SuccessFun(response);
        }
        function OnFailure(response) {
            FailureFun(response);
        }
        function OnComplete(response) {
            CompleteFun(response);
        }
        /*================Save for Later End=============*/
    </script>
}