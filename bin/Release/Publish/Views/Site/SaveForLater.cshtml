@model List<TitleLeader.Models.Dataupload.OpenOrderModels>
@{
    /**/

    ViewBag.Title = "SaveForLater";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
    Int32 fillteroption = ViewBag.FillterOption != null ? Convert.ToInt32(ViewBag.FillterOption) : 0;
}

<div class="padding-box">
    <div class="open-cart-text-box open-cart-text-box-reserch save-later-section">
        <div class="row">
            <div class="col-sm-6">
                <h3 class="haeding-text-gry"> Saved for later</h3>
                <p>Review all orderes & searches that have been entered but not yet submitted. </p>
            </div>
            <div class="col-sm-6 gray-header">

                <div class="open-carts-box">
                    <div class="heading-blue-box">
                        <span>Saved for Later Overview</span>

                    </div>
                    <div class="box-10-padding">
                        <div class="col-sm-6 box-part">
                            <span>Saved Order</span>
                            <span>@ViewBag.OrderCount </span>
                        </div>
                        <div class="col-sm-6 box-part">
                            <span>Saved searches</span>
                            <span>@ViewBag.OrderITemNo</span>
                        </div>


                    </div>


                </div>

            </div>
        </div>

        @using (Html.BeginForm("SaveForLater", "Site", FormMethod.Post, new { @id = "form-search" }))
        {
            <div class="row">
                <div class="col-sm-6 text-srch">
                    <div class="input-group">
                        <span class="input-group-addon" id="btn-search" style="cursor:pointer;"><i class="glyphicon glyphicon-search"></i></span>
                        <input id="orderid" type="text" value="@ViewBag.search" class="form-control" name="orderid" placeholder="Search Orders">
                    </div>

                </div>
                <div class="col-sm-3 text-right">
                    <ul class="filter-box">
                        <li>view</li>
                        <li><a href="#"><i class="fa fa-th-large" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-th-list" aria-hidden="true"></i></a></li>
                    </ul>
                </div>
                <div class="col-sm-3 text-right">
                    <select class="form-control" id="ddlFillter" name="fillter">
                        @switch (fillteroption)
                        {
                            case 0:
                                <option value="0" selected="selected">Date</option>
                                <option value="1">Order Number</option>
                                <option value="2">Betch Number</option>
                                <option value="3">Customer Name</option>
                                <option value="4">Address</option>
                                break;
                            case 1:
                                <option value="0">Date</option>
                                <option value="1" selected="selected">Order Number</option>
                                <option value="2">Betch Number</option>
                                <option value="3">Customer Name</option>
                                <option value="4">Address</option>
                                break;
                            case 2:
                                <option value="0">Date</option>
                                <option value="1">Order Number</option>
                                <option value="2" selected="selected">Betch Number</option>
                                <option value="3">Customer Name</option>
                                <option value="4">Address</option>
                                break;
                            case 3:
                                <option value="0" selected="selected">Date</option>
                                <option value="1">Order Number</option>
                                <option value="2">Betch Number</option>
                                <option value="3" selected="selected">Customer Name</option>
                                <option value="4">Address</option>
                                break;
                            case 4:
                                <option value="0" selected="selected">Date</option>
                                <option value="1">Order Number</option>
                                <option value="2">Betch Number</option>
                                <option value="3">Customer Name</option>
                                <option value="4" selected="selected">Address</option>
                                break;
                        }
                    </select>
                </div>
            </div>
        }
        <div class="row margin-top-20">
            <div class="col-sm-12">
                <h4>Saved Orders</h4>
            </div>
        </div>
        <div class="row">
            @foreach (var m in Model)
            {
                <div class="col-sm-4">

                    <div class="open-carts-box">
                        <div class="heading-blue-box">
                            <span>Order #</span>
                            <h3>@m.OrderNo</h3>
                        </div>
                        <div class="box-10-padding">
                            <div class="col-sm-6 box-part">
                                <span>Date Saved</span>
                                <span>@Convert.ToDateTime(m.OrderDate).ToString("MM-dd-yyyy")</span>
                            </div>
                            <div class="col-sm-6 box-part">
                                <span>Total searches</span>
                                <span>@m.Search</span>
                            </div>
                            <div class="pfd-section-cart">
                                <a href="#mydata" order_no="@m.OrderNo" class="btn_view">View searches </a>
                                <a style="cursor:pointer" orderid="@m.OrderNo" itemid="" class="btn_submit">Submit order now</a>
                                <a order_no="@m.OrderNo" itemid="" class="btn_delete" style="cursor:pointer">Delete</a>
                            </div>
                        </div>
                    </div>
                </div>
            }
            <div class="pagination">
                <a href="#">&laquo;</a>
                <a href="#"><i class="fa fa-angle-left" aria-hidden="true"></i></a>
                <a href="#">1</a>

                <a href="#"><i class="fa fa-angle-right" aria-hidden="true"></i></a>
                <a href="#">&raquo;</a>
            </div>
        </div>

        <div class="table-responsive" id="mydata">
            <table id="tbldisplay2" class="table">
                <thead>
                    <tr>

                        <th>Address</th>
                        <th>Unit</th>
                        <th>City</th>
                        <th>state</th>
                        <th>Zip</th>
                        <th>Country</th>
                        <th>Owner</th>
                        <th> &nbsp;</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="pagination">
            <a href="#">&laquo;</a>
            <a href="#"><i class="fa fa-angle-left" aria-hidden="true"></i></a>
            <a href="#">1</a>

            <a href="#"><i class="fa fa-angle-right" aria-hidden="true"></i></a>
            <a href="#">&raquo;</a>
        </div>

    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog" id="content_block">

    </div>
</div>

@section footer
{

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
    <script>
        var BeginFun = "";
        var SuccessFun = "";
        var FailureFun = "";
        var CompleteFun = "";


        $(document).ready(function () {

            $('[data-toggle="popover"]').popover();

            $("#btn-search").click(function () {
                $("#form-search").submit();
            });

            $(document).on("click", ".btn_submit", function () {
                var orderid = $(this).attr('orderid');
                var itemid = $(this).attr('itemid');

                swal({
                    title: "Are you sure?",
                    text: "Want to submit this orders!",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonClass: "btn-danger",
                    confirmButtonText: "Yes, Submit it!",
                    showLoaderOnConfirm: false,
                    closeOnConfirm: false
                }, function () {
                      $.ajax({

                        type: "GET",
                        async: false,
                        url: '@Url.Action("SaveForLatterSubmit", "Site")',
                          data: { 'strOrderNo': orderid, 'strOrderItem': itemid },
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (response) {
                         if (response == "success") {
                                swal({
                                    title: "Success!",
                                    text: "Order has been submited successfully.",
                                    type: "success",
                                    showCancelButton: false,
                                    confirmButtonColor: "#337ab7",
                                    confirmButtonText: "OK",
                                    closeOnConfirm: true,
                                    closeOnCancel: false
                                }, function (isConfirm) {
                                    var url = '@Url.Action("SaveForLater", "Site")';
                                    window.location.href = url;
                                });
                            }
                            else {
                                swal({
                                    title: "Error!",
                                    text: "Please try after some times.",
                                    type: "error",
                                    showCancelButton: false,
                                    confirmButtonColor: "#337ab7",
                                    confirmButtonText: "OK",
                                    closeOnConfirm: true,
                                    closeOnCancel: false
                                });
                            }

                        },
                        failure: function (response) {
                            alert(response.responseText);
                        },
                        error: function (response) {
                            alert(response.responseText);
                        },
                        complete: function (response) {


                        }
                    });

                });
            });

            $(document).on("click", ".btn_delete", function () {
                var ordno = $(this).attr('order_no');
                var itemid = $(this).attr('itemid');

                swal({
                    title: "Are you sure?",
                    text: "Want to delete this orders!",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonClass: "btn-danger",
                    confirmButtonText: "Yes, Delete it!",
                    showLoaderOnConfirm: false,
                    closeOnConfirm: false
                }, function () {
                    $.ajax({

                        type: "GET",
                        async: false,
                        url: '@Url.Action("DeleteOrder", "Site")',
                        data: { 'strOrderNo': ordno, 'strItemno': itemid },
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (response) {
                         if (response == "success") {
                                swal({
                                    title: "Success!",
                                    text: "Order has been deleted successfully.",
                                    type: "success",
                                    showCancelButton: false,
                                    confirmButtonColor: "#337ab7",
                                    confirmButtonText: "OK",
                                    closeOnConfirm: true,
                                    closeOnCancel: false
                                }, function (isConfirm) {
                                    var url = '@Url.Action("SaveForLater", "Site")';
                                    window.location.href = url;
                                });
                            }
                            else {
                                swal({
                                    title: "Error!",
                                    text: "Please try after some times.",
                                    type: "error",
                                    showCancelButton: false,
                                    confirmButtonColor: "#337ab7",
                                    confirmButtonText: "OK",
                                    closeOnConfirm: true,
                                    closeOnCancel: false
                                });
                            }

                        },
                        failure: function (response) {
                            alert(response.responseText);
                        },
                        error: function (response) {
                            alert(response.responseText);
                        },
                        complete: function (response) {


                        }
                    });
                });

            });

            $(document).on("click", ".btn_view", function () {
                var ordno = $(this).attr('order_no');
                orderitemlist(ordno);
            });
            $(document).on("click", ".btnedit", function () {
                var order_no = $(this).attr("orderid");
                var item_no = $(this).attr("itemid");
                SaveForLetterFun(order_no, item_no);
                $("#myModal").modal({
                    show: true,
                    backdrop: 'static',
                    keyboard: false
                });
            });

            var orderitemlist = function (ordno) {
                //debugger;
                // alert(ordno);
                $.ajax({

                    type: "GET",
                    async: false,
                    url: '@Url.Action("GetDetailsSaveForLater", "Site")',
                    data: { 'orderno': ordno },
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (response) {
                        $("#tbldisplay2>tbody").html('');

                        if (response != null) {

                            $.each(response, function (key, val) {
                                //alert(JSON.stringify(response));
                                strline = "<tr>";
                                strline += "<td>" + response[key].house_no + response[key].street_add + "</td>";
                                strline += "<td>" + response[key].house_unit + "</td>";
                                strline += "<td>" + response[key].city + "</td>";
                                strline += "<td>" + response[key].state + "</td>";
                                strline += "<td>" + response[key].zip_code + "</td>";
                                strline += "<td>-</td>";
                                strline += "<td>" + response[key].owner_first_name + response[key].owner_last_name + "</td>";
                               // strline += "<td><i class='fa fa-eye' aria-hidden='true'></i><a href='#mydata' orderid=" + response[key].order_no + " itemid=" + response[key].item_no + " class='btnedit' title='Action' data-toggle='popover' data-trigger='focus' data-content='Edit'> <img class='img-icon' src='/Content/images/dots.png'></a></td>";

                                strline += '<td><i class="fa fa-eye" aria-hidden="true"></i> <a type="button" style="cursor:pointer" data-container="body" data-toggle="popover" data-html="true" data-placement="top" data-content="<ul class=&quot;nav&quot;><li><a href=&quot;#mydata&quot; orderid=&quot;' + response[key].order_no + '&quot; itemid=&quot;' + response[key].item_no + '&quot; class=&quot;btnedit&quot;><i class=&quot;fa fa-pencil&quot;></i> Edit</li><li><a  href=&quot;#mydata&quot; orderid=&quot;' + response[key].order_no + '&quot; itemid=&quot;' + response[key].item_no + '&quot; class=&quot;btn_submit&quot;><i class=&quot;fa fa-repeat&quot;></i> Submit Now</li><li><a  href=&quot;#mydata&quot; order_no=&quot;' + response[key].order_no + '&quot; itemid=&quot;' + response[key].item_no + '&quot; class=&quot;btn_delete&quot;><i class=&quot;fa fa-times text-danger&quot;></i> Delete this Search</li></ul>" data-original-title="" title=""><img class="img-icon" src="/Content/images/dots.png"></a></td>';
                                strline += "</tr>";
                                strline += "<tr class='without-bg'><td colspan='9' style='background-color:#e4e7f2 !important;'></td></tr>";
                                $("#tbldisplay2>tbody").append(strline);
                            });
                        }
                        else {

                        }
                    },
                    failure: function (response) {
                        alert(response.responseText);
                    },
                    error: function (response) {
                        alert(response.responseText);
                    },
                    complete: function (response) {

                    }
                });
                $('[data-toggle="popover"]').popover();
            }

            var SaveForLetterFun = function (order_no, item_no) {
                $.ajax({
                    type: "GET",
                    async: false,
                    url: '@Url.Action("EditSaveForLatter", "Site")',
                    data: { orderno: '' + order_no + '', itemno: '' + item_no + '' },
                    contentType: "application/html; charset=utf-8",
                    dataType: "html",
                    success: function (response) {
                        $("#content_block").html(response);
                        $.validator.unobtrusive.parse($("#content_block"));
                    },
                    failure: function (response) {
                        alert("Error in Personal");
                    },
                    error: function (response) {
                        alert("Error in Personal");
                    },
                    complete: function (response) {

                    }
                });
            }

            var Begin = function (response) {
            }
            BeginFun = Begin;

            var Success = function (response) {
                if (response != "error") {
                    swal({
                        title: "Success!",
                        text: "Your Details has been updated",
                        type: "success",
                        showCancelButton: false,
                        confirmButtonColor: "#337ab7",
                        confirmButtonText: "OK",
                        closeOnConfirm: false,
                        closeOnCancel: false
                    }, function (isConfirm) {
                        //orderitemlist(response);
                        var url = '@Url.Action("SaveForLater", "Site")';
                        window.location.href = url;
                    });
                }
            }
            SuccessFun = Success;

            var Failure = function (response) {
            }
            FailureFun = Failure;

            var Complete = function (response) {
            }
            CompleteFun = Complete;

        });

        function OnBegin(response) {
            BeginFun(response);
        }
        function OnSuccess(response) {
            SuccessFun(response);
        }
        function OnFailure(response) {
            FailureFun(response);
        }
        function OnComplete(response) {
            CompleteFun(response);
        }

    </script>
}